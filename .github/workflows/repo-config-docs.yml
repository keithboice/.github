name: Generate repo config docs

on:
    issues:
        types: [labeled]

    workflow_dispatch:

jobs:
    Generate:
        if: contains(github.event.label.name, 'actions' )
        name: Generate repo docs
        runs-on: ubuntu-latest

        steps:
            - name: Create Action Branch
              uses: peterjgrainger/action-create-branch@v2.0.1
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              with:
                  branch: 'actions_conf'

            - name: Checkout
              uses: actions/checkout@v2
              with:
                  ref: 'actions_conf'
                  submodules: 'recursive'

            - name: Meta
              uses: varunsridharan/action-repository-meta@main
              env:
                  github_token: ${{ secrets.GITHUB_TOKEN }}

            - name: Render
              uses: varunsridharan/action-dynamic-readme@main
              with:
                  FILES: |
                      ./package.json.core.template=package.json
                      .conf/content/ignores/default.gitignore=.gitignore
              env:
                  github_token: ${{ secrets.GITHUB_TOKEN }}

            - name: Commit
              run: |
                  git config user.name github-actions
                  git config user.email github-actions@github.com
                  git add .
                  git commit -m "feat(actions_conf)"

            - name: Push
              uses: ad-m/github-push-action@master
              with:
                  github_token: ${{ secrets.GITHUB_TOKEN }}
                  branch: 'actions_conf'
                  force: true
